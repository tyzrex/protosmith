import serviceClients from '@transport/gateway/gRPC/clients/client-registery';
import { interceptorRegistry } from '@transport/interceptor-registry';
import type { {{schema.name}}Client } from '@transport/gateway/gRPC/stubs/{{descriptor}}.client';
{{#each (groupImportsBySource schema.methods descriptor)}}
import type { {{#each types}}{{this}}{{#unless @last}}, {{/unless}}{{/each}} } from '@transport/gateway/gRPC/stubs/{{source}}';
{{/each}}

const grpcInterceptor = interceptorRegistry.getInterceptor('grpc');

{{#each schema.methods}}
export const {{name}} = (
  request: {{input}},
  retries: number = 1
): Promise<{{output}}> =>
  {
    return grpcInterceptor.intercept<{{../schema.name}}Client>({
      client: serviceClients.{{../module}}ServiceClient,
      method: (client) => client.{{name}}.bind(client),
      args: request,
      retries
    });
  }

{{/each}}
export const {{module}}ServiceRequests = {
  {{#each schema.methods}}{{name}},
  {{/each}}
};
